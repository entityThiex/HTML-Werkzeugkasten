<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Oberklasse-Feld (Basisversion)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      height: 100vh;
      margin: 0;
      overflow: hidden;
    }

    #form-builder {
      position: relative;
      margin: 0 auto;
      width: 50%;
      height: 100%;
      background: #f0f0f0;
    }

    .field {
      position: absolute;
      top: 50px;
      left: 50px;
      width: 100%;
      background: #ffffff;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }

    .field-header {
      cursor: move;
      background: #007bff;
      color: #fff;
      padding: 8px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 6px 6px 0 0;
    }

    .field-title {
      font-size: 14px;
      font-weight: bold;
      position: relative;
    }

    /* Tooltip */
    .field-title[data-info]:hover::after {
      content: attr(data-info);
      position: absolute;
      left: 0;
      top: 130%;
      background: #333;
      color: #fff;
      padding: 6px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 10;
    }

    .field-required {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
    }

    .field-body {
      padding: 8px 10px 10px;
    }

    .field-required-indicator {
      color: #ffeb3b;
      margin-left: 4px;
      font-size: 14px;
    }

    /* Konfiguration (Titel & Zusatzinfo) */
    .field-config {
      margin-bottom: 8px;
      padding: 6px;
      background: #f5f5f5;
      border-radius: 4px;
      border: 1px solid #ddd;
      font-size: 12px;
    }

    .field-config label {
      display: block;
      margin-bottom: 3px;
      font-weight: bold;
    }

    .field-config input[type="text"],
    .field-config textarea {
      width: 100%;
      box-sizing: border-box;
      font-size: 12px;
      padding: 4px;
      border-radius: 3px;
      border: 1px solid #ccc;
      margin-bottom: 6px;
      resize: vertical;
    }

    .dropbtn {
        background-color: #04AA6D;
        color: white;
        padding: 16px;
        font-size: 16px;
        border: none;
    }

    .dropdown {
        position: relative;
        top: 0;
        left: 0;
        display: inline-block;
    }
    .dropdown-content {
        display: none;
        position: fixed;
        background-color: #f1f1f1;
        min-width: 160px;
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
        z-index: 2;
    }

    .dropdown-content button {
        color: black;
        width: 100%;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    /* Change color of dropdown links on hover */
    .dropdown-content button:hover {background-color: #ddd;}

    /* Show the dropdown menu on hover */
    .dropdown:hover .dropdown-content {display: block;}

    /* Change the background color of the dropdown button when the dropdown content is shown */
    .dropdown:hover .dropbtn {background-color: #3e8e41;}

    .topmenu {
        height: 50px;
        width: 100%;
        position: sticky;
        top: 0;
        overflow-y: visible;
        z-index: 1;
    }

    .page {
        overflow-y: auto;
        position: relative;
        height: 100%;
        width: 100%;
    }

    .move-btn {
        height: 100%;
    }
  </style>
</head>
<body>


    <div class="topmenu">
      <div class="dropdown">
          <button class="dropbtn">Hinzufügen</button>
          <div class="dropdown-content">
              <button onclick="addTextField()">Text</button>
              <button onclick="addInfoField()">Info</button>
              <button onclick="addNumberField()">Zahlen</button>
              <button onclick="addDateField()">Datum</button>
              <button onclick="addPictureField()">Bild</button>
              <button onclick="addFileField()">Datei</button>
              <button onclick="addDropdownField()">Dropdown</button>
              <button onclick="addMultipleChoiceField()">Mehrfachauswahl</button>
          </div>
      </div>

      <div class="dropdown">
          <button class="dropbtn">Export</button>
          <div class="dropdown-content">
              <button id="saveBtn">Speichern</button>
              <button id="exportBtn">Exportieren</button>
          </div>
      </div>

      <button class="dropbtn">Import</button>

    </div>


    <div class="page">
      <div id="form-builder"></div>
    </div>

  <script>
    // ===== Oberklasse: BaseField =====
    class BaseField {
      static instanceCounter = 0;  // Statische Variable für alle Instanzen

      constructor(options) {
        BaseField.instanceCounter++;  // Erhöhe Zähler bei jeder neuen Instanz
        this.instanceId = BaseField.instanceCounter;  // Speichere aktuelle Nummer in der Instanz
        
        this.type = options.type || "base";         
        this.title = options.title || "";       // intern gespeichert
        this.infoText = options.infoText || "";     
        this.required = !!options.required;
        this.x = options.x || 0;
        this.y = options.y || 0;

        this.createDOM();
        this.initDrag();
        this.initRequiredCheckbox();
        this.initConfigUI(); // Titel + Zusatzinfo editierbar
      }

      createDOM() {
        const container = document.getElementById("form-builder");

        this.el = document.createElement("div");
        this.el.className = "field";
        this.el.style.left = this.x + "px";
        this.el.style.top = this.y + "px";
        this.el.id = String(this.instanceId)

        // Header
        const header = document.createElement("div");
        header.className = "field-header";

        const titleSpan = document.createElement("span");
        titleSpan.className = "field-title";
        titleSpan.textContent = "Feld"; // Anzeige bleibt immer gleich
        if (this.infoText) {
          titleSpan.setAttribute("data-info", this.infoText);
        }
        this.titleEl = titleSpan;

        const centerHeader = document.createElement("div");
        centerHeader.className = "move-buttons";

        const btnUp = document.createElement("button");
        btnUp.className = "move-btn";
        btnUp.textContent = "^"
        const field = this.el;
        const parent = this
        btnUp.onclick = function () {
            container.insertBefore(field, field.previousElementSibling);
            parent.repositionAllFields();
        };

        const btnDown = document.createElement("button");
        btnDown.className = "move-btn";
        btnDown.textContent = "v"
        btnDown.onclick = function () {
            console.log(field);
            container.insertBefore(field.nextElementSibling, field);
            parent.repositionAllFields()
        }

        const rightHeader = document.createElement("div");
        rightHeader.className = "field-required";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = this.required;
        this.requiredCheckbox = cb;

        const cbLabel = document.createElement("span");
        cbLabel.textContent = "Pflicht";

        const reqIndicator = document.createElement("span");
        reqIndicator.className = "field-required-indicator";
        reqIndicator.textContent = this.required ? "*" : "";
        this.requiredIndicator = reqIndicator;

        // Delete Button hinzufügen
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "×";
        deleteBtn.style.marginLeft = "10px";
        deleteBtn.style.padding = "2px 8px";
        deleteBtn.style.backgroundColor = "#ff4444";
        deleteBtn.style.color = "white";
        deleteBtn.style.border = "none";
        deleteBtn.style.borderRadius = "3px";
        deleteBtn.style.cursor = "pointer";
        deleteBtn.style.fontSize = "16px";
        deleteBtn.style.fontWeight = "bold";
        
        deleteBtn.addEventListener("click", () => {
          this.el.remove();
          // Repositioniere alle verbleibenden Felder nach dem Löschen
          setTimeout(() => {
            const container = document.getElementById("form-builder");
            const allFields = container.querySelectorAll(".field");
            let currentY = 0;
            
            allFields.forEach(field => {
              field.style.left = "0px";
              field.style.top = currentY + "px";
              currentY += field.offsetHeight + 10;
            });
          }, 0);
        });

        rightHeader.appendChild(btnUp);
        rightHeader.appendChild(btnDown);
        rightHeader.appendChild(cb);
        rightHeader.appendChild(cbLabel);
        rightHeader.appendChild(reqIndicator);
        rightHeader.appendChild(deleteBtn);

        //centerHeader.appendChild(btnUp);
        //centerHeader.appendChild(btnDown);

        header.appendChild(titleSpan);
        header.appendChild(centerHeader)
        header.appendChild(rightHeader);

        const body = document.createElement("div");
        body.className = "field-body";
        this.bodyEl = body;

        this.el.appendChild(header);
        this.el.appendChild(body);
        container.appendChild(this.el);
      }

      initRequiredCheckbox() {
        this.requiredCheckbox.addEventListener("change", () => {
          this.required = this.requiredCheckbox.checked;
          this.requiredIndicator.textContent = this.required ? "*" : "";
        });
      }

      // Titel + Zusatzinfo editierbar (intern gespeichert)
      initConfigUI() {
        const config = document.createElement("div");
        config.className = "field-config";

        // Titel (intern gespeichert, nicht sichtbar im Header)
        const titleLabel = document.createElement("label");
        titleLabel.textContent = "Titel";

        const titleInput = document.createElement("input");
        titleInput.type = "text";
        titleInput.value = this.title;

        titleInput.addEventListener("input", () => {
          this.title = titleInput.value;
        });

        // Zusatzinfo (Tooltip)
        const infoLabel = document.createElement("label");
        infoLabel.textContent = "Zusatzinfo";

        const infoInput = document.createElement("textarea");
        infoInput.rows = 2;
        infoInput.value = this.infoText;

        infoInput.addEventListener("input", () => {
          this.infoText = infoInput.value;
          if (this.infoText.trim()) {
            this.titleEl.setAttribute("data-info", this.infoText);
          } else {
            this.titleEl.removeAttribute("data-info");
          }
        });

        config.appendChild(titleLabel);
        config.appendChild(titleInput);
        config.appendChild(infoLabel);
        config.appendChild(infoInput);

        this.bodyEl.appendChild(config);
      }

      initDrag() {
        // Mache das Feld draggable
        this.el.draggable = true;

        // Drag & Drop für Reihenfolge
        this.el.addEventListener('dragstart', (e) => {
          this.el.classList.add('dragging');
          this.el.style.opacity = '0.5';
          e.dataTransfer.effectAllowed = 'move';
        });

        this.el.addEventListener('dragend', (e) => {
          this.el.classList.remove('dragging');
          this.el.style.opacity = '1';
          this.repositionAllFields();
        });

        this.el.addEventListener('dragover', (e) => {
          e.preventDefault();
          const container = document.getElementById("form-builder");
          const draggingItem = container.querySelector('.dragging');
          if (!draggingItem || draggingItem === this.el) return;

          const siblings = [...container.querySelectorAll('.field:not(.dragging)')];
          const nextSibling = siblings.find(sibling => {
            const box = sibling.getBoundingClientRect();
            const offset = e.clientY - box.top - box.height / 2;
            return offset < 0;
          });

          if (nextSibling) {
            container.insertBefore(draggingItem, nextSibling);
          } else {
            container.appendChild(draggingItem);
          }
        });

        this.el.addEventListener('dragenter', (e) => {
          e.preventDefault();
          if (!this.el.classList.contains('dragging')) {
            this.el.style.borderTop = '3px solid #007bff';
          }
        });

        this.el.addEventListener('dragleave', (e) => {
          this.el.style.borderTop = '';
        });

        this.el.addEventListener('drop', (e) => {
          e.preventDefault();
          this.el.style.borderTop = '';
        });
      }

      repositionAllFields() {
        const container = document.getElementById("form-builder");
        const allFields = container.querySelectorAll(".field");
        let currentY = 0;

        allFields.forEach(field => {
          field.style.left = "0px";
          field.style.top = currentY + "px";
          currentY += field.offsetHeight + 10;
        });
      }

      // Für spätere HTML-Erzeugung vorbereiten
      toConfigObject() {
        const rect = this.el.getBoundingClientRect();
        const parentRect = this.el.parentElement.getBoundingClientRect();
        return {
          type: this.type,
          title: this.title,         // gespeicherter individueller Titel
          infoText: this.infoText,   // gespeicherter Tooltip
          required: this.required,
          x: rect.left - parentRect.left,
          y: rect.top - parentRect.top
        };
      }
    }
    // Hinweis: toConfigObject() liefert später alle wichtigen Daten für HTML-Generierung

    class Textfield extends BaseField {
      constructor(options) {
        super({ ...options, type: "text" });
        this.createTextInput();
        this.titleEl.textContent = "Textfeld";
      }

      createTextInput() {
        const wrapper = document.createElement("div");

        // Label hinzufügen
        const label = document.createElement("label");
        label.textContent = "Text";
        label.style.display = "block";
        label.style.marginBottom = "4px";
        label.style.fontSize = "12px";

        // Input erstellen
        const input = document.createElement("input");
        input.type = "text";
        input.style.width = "100%";
        input.style.boxSizing = "border-box";

        // Alles zusammenfügen
        wrapper.appendChild(label);
        wrapper.appendChild(input);
        this.bodyEl.appendChild(wrapper);
      }
    }


    class DropDownfield extends BaseField {
      constructor(options) {
        super({ ...options, type: "dropdown" });
        this.options = [];
        this.createSelectInput();
        this.titleEl.textContent = "Dropdown-Feld";
      }

      createSelectInput() {
        const wrapper = document.createElement("div");

        // Label für das Dropdown
        const label = document.createElement("label");
        label.textContent = "Optionen";
        label.style.display = "block";
        label.style.marginBottom = "4px";
        label.style.fontSize = "12px";

        // Container für Input und Button
        const inputContainer = document.createElement("div");
        inputContainer.style.display = "flex";
        inputContainer.style.marginBottom = "10px";
        inputContainer.style.gap = "5px";

        // Textfeld für neue Optionen
        const input = document.createElement("input");
        input.type = "text";
        input.style.flex = "1";
        input.placeholder = "Neue Option eingeben";

        // Hinzufügen Button
        const addButton = document.createElement("button");
        addButton.textContent = "Hinzufügen";
        addButton.style.padding = "4px 8px";

        // Styling für drag & drop hinzufügen
        const optionsContainer = document.createElement("div");
        optionsContainer.style.maxHeight = "150px";
        optionsContainer.style.overflowY = "auto";
        optionsContainer.style.padding = "4px";

        // Event Listener für das Hinzufügen
        addButton.addEventListener("click", () => {
            if (input.value.trim()) {
                this.addOption(input.value.trim());
                input.value = "";
            }
        });

        // Enter-Taste auch zum Hinzufügen nutzen
        input.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && input.value.trim()) {
                this.addOption(input.value.trim());
                input.value = "";
            }
        });

        inputContainer.appendChild(input);
        inputContainer.appendChild(addButton);

        wrapper.appendChild(label);
        wrapper.appendChild(inputContainer);
        wrapper.appendChild(optionsContainer);

        this.optionsContainer = optionsContainer;
        this.bodyEl.appendChild(wrapper);
      }

      addOption(text) {
        const optionDiv = document.createElement("div");
        optionDiv.style.display = "flex";
        optionDiv.style.justifyContent = "space-between";
        optionDiv.style.alignItems = "center";
        optionDiv.style.padding = "4px";
        optionDiv.style.marginBottom = "4px";
        optionDiv.style.backgroundColor = "#f5f5f5";
        optionDiv.style.borderRadius = "4px";
        optionDiv.style.cursor = "move"; // Cursor für Drag & Drop

        // Drag & Drop Attribute
        optionDiv.draggable = true;

        // Drag & Drop Event Listener
        optionDiv.addEventListener('dragstart', (e) => {
            e.target.classList.add('dragging');
            e.target.style.opacity = '0.5';
        });

        optionDiv.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
            e.target.style.opacity = '1';
            this.updateOptions();
        });

        optionDiv.addEventListener('dragover', (e) => {
            e.preventDefault();
            const draggingItem = this.optionsContainer.querySelector('.dragging');
            const siblings = [...this.optionsContainer.querySelectorAll('div:not(.dragging)')];
            const nextSibling = siblings.find(sibling => {
                const box = sibling.getBoundingClientRect();
                const offset = e.clientY - box.top - box.height / 2;
                return offset < 0;
            });

            if (nextSibling) {
                this.optionsContainer.insertBefore(draggingItem, nextSibling);
            } else {
                this.optionsContainer.appendChild(draggingItem);
            }
        });

        // Highlight beim Draggen
        optionDiv.addEventListener('dragenter', (e) => {
            e.preventDefault();
            optionDiv.style.borderTop = '2px solid #007bff';
        });

        optionDiv.addEventListener('dragleave', (e) => {
            e.preventDefault();
            optionDiv.style.borderTop = 'none';
        });

        optionDiv.addEventListener('drop', (e) => {
            e.preventDefault();
            optionDiv.style.borderTop = 'none';
        });

        const optionText = document.createElement("span");
        optionText.textContent = text;
        optionText.style.fontSize = "12px";
        optionText.style.pointerEvents = "none"; // Verhindert Störungen beim Drag & Drop

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "×";
        deleteButton.style.padding = "2px 6px";
        deleteButton.style.backgroundColor = "#ff4444";
        deleteButton.style.color = "white";
        deleteButton.style.border = "none";
        deleteButton.style.borderRadius = "3px";
        deleteButton.style.cursor = "pointer";

        deleteButton.addEventListener("click", () => {
            optionDiv.remove();
            this.updateOptions();
        });

        optionDiv.appendChild(optionText);
        optionDiv.appendChild(deleteButton);
        this.optionsContainer.appendChild(optionDiv);

        this.updateOptions();
      }

      updateOptions() {
        // Aktualisiert das Array mit allen Optionen
        this.options = Array.from(this.optionsContainer.querySelectorAll("span"))
            .map(span => span.textContent);
      }

      toConfigObject() {
        const baseConfig = super.toConfigObject();
        return {
            ...baseConfig,
            options: this.options
        };
      }
    }


    class DateField extends BaseField {

        constructor(options){
            super({...options, type: "date"});
            this.titleEl.textContent = "Datum";
            this.createDateInput()
        }

        createDateInput() {
            const wrapper = document.createElement("div");

            // Label
            const label = document.createElement("label");
            label.textContent = "Datum Feld";
            label.style.display = "block";
            label.style.marginBottom = "4px";
            label.style.fontSize = "12px";

            // Input
            const input = document.createElement("input");
            input.type = "date";
            input.style.width = "100%";
            input.style.boxSizing = "border-box";

            // Combine the ELEMENTS!!!!
            wrapper.appendChild(label);
            wrapper.appendChild(input);
            this.bodyEl.appendChild(wrapper);
        }
    }


    // Darf später nicht bearbeitbar sein, ansonsten ists gleich wie das Textfeld
    // Ist frei ziehbar, sollte auch nicht sein
    class InfoField extends BaseField {

        constructor(options){
            super({...options, type: "info", required: false});
            this.value
            this.titleEl.textContent = "Infofeld";
            this.createInfoInput();
        }

        createInfoInput() {
            const wrapper = document.createElement("div");

            // Label
            const label = document.createElement("label");
            label.textContent = "Info Feld";
            label.style.display = "block";
            label.style.marginBottom = "4px";
            label.style.fontSize = "12px";

            // Input
            const input = document.createElement("textarea");
            input.rows = 2;
            this.value = input.value
            input.style.width = "100%";
            input.style.boxSizing = "border-box";

            // Combine the ELEMENTS!!!!
            wrapper.appendChild(label);
            wrapper.appendChild(input);
            this.bodyEl.appendChild(wrapper);
        }

        toConfigObject() {
            const rect = this.el.getBoundingClientRect();
            const parentRect = this.el.parentElement.getBoundingClientRect();
            return {
                type: this.type,
                title: this.title,         // gespeicherter individueller Titel
                infoText: this.infoText,   // gespeicherter Tooltip
                required: this.required,
                content: this.value,
                x: rect.left - parentRect.left,
                y: rect.top - parentRect.top
            };
        }
    }


    class PictureField extends BaseField {

        constructor(options){
            super({...options, type: "picture"});
            this.titleEl.textContent = "Bild";
            this.createPictureInput();
        }

        createPictureInput() {
            const wrapper = document.createElement("div");

            // Label
            const label = document.createElement("label");
            label.textContent = "Bild Feld";
            label.style.display = "block";
            label.style.marginBottom = "4px";
            label.style.fontSize = "12px";

            // Input
            const input = document.createElement("input");
            input.type = "file";
            input.accept = "image/*";
            input.style.width = "100%";
            input.style.boxSizing = "border-box";

            // Combine the ELEMENTS!!!!
            wrapper.appendChild(label);
            wrapper.appendChild(input);
            this.bodyEl.appendChild(wrapper);
        }
    }


    class FileField extends BaseField {

        constructor(options){
            super({...options, type: "file"});
            this.titleEl.textContent = "Datei";
            this.createPictureInput();
        }

        createPictureInput() {
            const wrapper = document.createElement("div");

            // Label
            const label = document.createElement("label");
            label.textContent = "Datei Feld";
            label.style.display = "block";
            label.style.marginBottom = "4px";
            label.style.fontSize = "12px";

            // Input
            const input = document.createElement("input");
            input.type = "file";
            input.style.width = "100%";
            input.style.boxSizing = "border-box";

            // Combine the ELEMENTS!!!!
            wrapper.appendChild(label);
            wrapper.appendChild(input);
            this.bodyEl.appendChild(wrapper);
        }
    }

    class NumberField extends BaseField {

        constructor(options){
            super({...options, type: "number"});
            this.titleEl.textContent = "Zahlenfeld";
            this.createNumberInput()
        }

        createNumberInput() {
            const wrapper = document.createElement("div");

            // Label
            const label = document.createElement("label");
            label.textContent = "Nummer Feld";
            label.style.display = "block";
            label.style.marginBottom = "4px";
            label.style.fontSize = "12px";

            // Input
            const input = document.createElement("input");
            input.type = "number";
            input.style.width = "100%";
            input.style.boxSizing = "border-box";

            // Combine the ELEMENTS!!!!
            wrapper.appendChild(label);
            wrapper.appendChild(input);
            this.bodyEl.appendChild(wrapper);
        }
    }


    class Radio_MultipleChoicefield extends BaseField {
      constructor(options) {
        super({ ...options, type: "radio_multiple" });
        this.options = [];
        this.allowMultiple = false;
        this.createOptionsInput();
        this.titleEl.textContent = "Radio-/Multiple-Choice-Feld";
      }

      createOptionsInput() {
        const wrapper = document.createElement("div");

        // Checkbox für Mehrfachauswahl
        const multipleChoiceContainer = document.createElement("div");
        multipleChoiceContainer.style.marginBottom = "10px";

        const multipleChoice = document.createElement("input");
        multipleChoice.type = "checkbox";
        multipleChoice.id = "multipleChoice_" + this.instanceId;
        multipleChoice.checked = this.allowMultiple;

        const multipleChoiceLabel = document.createElement("label");
        multipleChoiceLabel.htmlFor = "multipleChoice_" + this.instanceId;
        multipleChoiceLabel.textContent = "Mehrfachauswahl erlauben";
        multipleChoiceLabel.style.fontSize = "12px";
        multipleChoiceLabel.style.marginLeft = "5px";

        multipleChoice.addEventListener("change", () => {
            this.allowMultiple = multipleChoice.checked;
            this.updateOptionsPreview();
        });

        multipleChoiceContainer.appendChild(multipleChoice);
        multipleChoiceContainer.appendChild(multipleChoiceLabel);

        // Label für die Optionen
        const label = document.createElement("label");
        label.textContent = "Auswahlmöglichkeiten";
        label.style.display = "block";
        label.style.marginBottom = "4px";
        label.style.fontSize = "12px";

        // Container für Input und Button
        const inputContainer = document.createElement("div");
        inputContainer.style.display = "flex";
        inputContainer.style.marginBottom = "10px";
        inputContainer.style.gap = "5px";

        // Textfeld für neue Optionen
        const input = document.createElement("input");
        input.type = "text";
        input.style.flex = "1";
        input.placeholder = "Neue Auswahlmöglichkeit eingeben";

        // Hinzufügen Button
        const addButton = document.createElement("button");
        addButton.textContent = "Hinzufügen";
        addButton.style.padding = "4px 8px";

        // Container für die Optionsliste
        const optionsContainer = document.createElement("div");
        optionsContainer.style.maxHeight = "150px";
        optionsContainer.style.overflowY = "auto";
        optionsContainer.style.padding = "4px";

        // Event Listener für das Hinzufügen
        addButton.addEventListener("click", () => {
            if (input.value.trim()) {
                this.addOption(input.value.trim());
                input.value = "";
            }
        });

        // Enter-Taste auch zum Hinzufügen nutzen
        input.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && input.value.trim()) {
                this.addOption(input.value.trim());
                input.value = "";
            }
        });

        wrapper.appendChild(multipleChoiceContainer);
        wrapper.appendChild(label);
        inputContainer.appendChild(input);
        inputContainer.appendChild(addButton);
        wrapper.appendChild(inputContainer);
        wrapper.appendChild(optionsContainer);

        this.optionsContainer = optionsContainer;
        this.bodyEl.appendChild(wrapper);
      }

      addOption(text) {
        const optionDiv = document.createElement("div");
        optionDiv.style.display = "flex";
        optionDiv.style.justifyContent = "space-between";
        optionDiv.style.alignItems = "center";
        optionDiv.style.padding = "4px";
        optionDiv.style.marginBottom = "4px";
        optionDiv.style.backgroundColor = "#f5f5f5";
        optionDiv.style.borderRadius = "4px";
        optionDiv.style.cursor = "move";

        optionDiv.draggable = true;

        // Radio/Checkbox Vorschau
        const inputPreview = document.createElement("input");
        inputPreview.type = this.allowMultiple ? "checkbox" : "radio";
        inputPreview.name = "preview_" + this.instanceId;
        inputPreview.style.marginRight = "8px";
        inputPreview.style.cursor = "default";
        inputPreview.onclick = (e) => e.preventDefault();

        const optionText = document.createElement("span");
        optionText.textContent = text;
        optionText.style.fontSize = "12px";
        optionText.style.flex = "1";
        optionText.style.pointerEvents = "none";

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "×";
        deleteButton.style.padding = "2px 6px";
        deleteButton.style.backgroundColor = "#ff4444";
        deleteButton.style.color = "white";
        deleteButton.style.border = "none";
        deleteButton.style.borderRadius = "3px";
        deleteButton.style.cursor = "pointer";
        deleteButton.style.marginLeft = "8px";

        // Drag & Drop Event Listener
        this.addDragListeners(optionDiv);

        deleteButton.addEventListener("click", () => {
            optionDiv.remove();
            this.updateOptions();
        });

        const textContainer = document.createElement("div");
        textContainer.style.display = "flex";
        textContainer.style.alignItems = "center";
        textContainer.style.flex = "1";
        textContainer.appendChild(inputPreview);
        textContainer.appendChild(optionText);

        optionDiv.appendChild(textContainer);
        optionDiv.appendChild(deleteButton);
        this.optionsContainer.appendChild(optionDiv);

        this.updateOptions();
      }

      addDragListeners(optionDiv) {
        optionDiv.addEventListener('dragstart', (e) => {
            e.target.classList.add('dragging');
            e.target.style.opacity = '0.5';
        });

        optionDiv.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
            e.target.style.opacity = '1';
            this.updateOptions();
        });

        optionDiv.addEventListener('dragover', (e) => {
            e.preventDefault();
            const draggingItem = this.optionsContainer.querySelector('.dragging');
            const siblings = [...this.optionsContainer.querySelectorAll('div:not(.dragging)')];
            const nextSibling = siblings.find(sibling => {
                const box = sibling.getBoundingClientRect();
                const offset = e.clientY - box.top - box.height / 2;
                return offset < 0;
            });

            if (nextSibling) {
                this.optionsContainer.insertBefore(draggingItem, nextSibling);
            } else {
                this.optionsContainer.appendChild(draggingItem);
            }
        });

        optionDiv.addEventListener('dragenter', (e) => {
            e.preventDefault();
            optionDiv.style.borderTop = '2px solid #007bff';
        });

        optionDiv.addEventListener('dragleave', (e) => {
            e.preventDefault();
            optionDiv.style.borderTop = 'none';
        });

        optionDiv.addEventListener('drop', (e) => {
            e.preventDefault();
            optionDiv.style.borderTop = 'none';
        });
      }

      updateOptionsPreview() {
        const inputs = this.optionsContainer.querySelectorAll('input');
        inputs.forEach(input => {
            input.type = this.allowMultiple ? "checkbox" : "radio";
        });
      }

      updateOptions() {
        this.options = Array.from(this.optionsContainer.querySelectorAll("span"))
            .map(span => span.textContent);
      }

      toConfigObject() {
        const baseConfig = super.toConfigObject();
        return {
            ...baseConfig,
            options: this.options,
            allowMultiple: this.allowMultiple
        };
      }
    }


// Funktionen zum Erstellen der verschiedenen Feldtypen mit versetzten Positionen
let fieldOffsetCounter = 0;
let lastFieldHeight = 0;
let currentYPosition = 0;

function calculateNextPosition() {
    const container = document.getElementById("form-builder");
    const allFields = container.querySelectorAll(".field");
    
    if (allFields.length === 0) {
        currentYPosition = 0;
        return 0;
    }
    
    // Finde das unterste Feld
    let maxBottom = 0;
    allFields.forEach(field => {
        const top = parseInt(field.style.top) || 0;
        const height = field.offsetHeight;
        const bottom = top + height;
        if (bottom > maxBottom) {
            maxBottom = bottom;
        }
    });
    
    // Füge einen kleinen Abstand hinzu
    currentYPosition = maxBottom + 10;
    return currentYPosition;
}

function addTextField() {
    new Textfield({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addInfoField() {
    new InfoField({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addFileField() {
    new FileField({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addNumberField() {
    new NumberField({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addDateField() {
    new DateField({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addPictureField() {
    new PictureField({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addDropdownField() {
    new DropDownfield({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

function addMultipleChoiceField() {
    new Radio_MultipleChoicefield({
        title: "",
        infoText: "",
        required: false,
        x: 0,
        y: calculateNextPosition()
    });
}

// Drag & Drop für den Container aktivieren
const formBuilder = document.getElementById("form-builder");

formBuilder.addEventListener('dragover', (e) => {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
});

formBuilder.addEventListener('drop', (e) => {
  e.preventDefault();
});
  </script>
  <script>
      // script for updating and saving
      function downloadBuilder(){
          let jsonLink = document.createElement('a');
          jsonLink.href = URL.createObjectURL(new File([getSpecsBlob()], "specs.json"));
          jsonLink.download = 'specs.json';
          jsonLink.click();
      }

      function exportBuilder(){
          let formLink = document.createElement('a');
          formLink.href = URL.createObjectURL(new File([getFormBlob()], "form.html"));
          formLink.download = 'form.html';
          formLink.click();

          let evalLink = document.createElement('a');
          evalLink.href = URL.createObjectURL(new File([getEvalBlob()], "eval.html"));
          evalLink.download = 'eval.html';
          evalLink.click();
      }

      let specs = {
          "vars": {
              "id-counter": 0
          },
          "form": {
              "fields": [],
              "scripts": []
          },
          "eval": {
              "fields": [],
              "scripts": []
          }
      }

      let defaultSpecs = {
          "form": {
              "fields": [],
              "scripts": []
          },
          "eval": {
              "fields": [],
              "scripts": []
          }
      }

      function createFormFromJson(){
          return createHTMLFromJson("form");
      }

      function createEvalFromJson(){
          return createHTMLFromJson("eval");
      }

      function createHTMLFromJson(type){
          let fields = defaultSpecs[type]["fields"].concat(specs[type]["fields"]);
          let html = new HtmlObj();
          if (fields != null && fields instanceof Array && fields.length > 0){
              fields.forEach(html.append());
          }

          let scripts = defaultSpecs[type]["scripts"].concat(specs[type]["scripts"]);
          if (scripts != null && scripts instanceof Array && scripts.length > 0){
              scripts.forEach(html.append());
          }

          return html.finish();
      }

      function getSpecsBlob(){
          let jsonSpecs = new JsonObj(specs);
          return jsonSpecs.getDownloadFile();
      }

      function getFormBlob(){
          let htmlForm = createFormFromJson();
          return htmlForm.getDownloadFile();
      }

      function getEvalBlob(){
          let htmlEval = createEvalFromJson();
          return htmlEval.getDownloadFile();
      }

      function createZip(json, files){

      }

      function loadFile(){

      }

      class Obj{
          constructor() {

          }

          getDownloadFile(data, type){
              return new Blob([data], {type: type});
          }
      }

      class HtmlObj extends Obj{
          fullHtml = "";
          htmlHeader = "<header>";
          htmlBody = "<body>";
          htmlFooter = "<footer>";

          constructor(html = "<!DOCTYPE html><html lang=\"de\">"){
              super();
              this.fullHtml = html;
          }

          append(jsonHtml){
              if(jsonHtml != null && jsonHtml instanceof JSON && jsonHtml.has("html")){
                  if (jsonHtml.has("type") && jsonHtml["type"] === "header"){
                      this.htmlHeader += jsonHtml["html"];
                  }
                  else if (jsonHtml.has("type") && jsonHtml["type"] === "body") {
                      this.htmlBody += jsonHtml["html"];
                  }
                  else if (jsonHtml.has("type") && jsonHtml["type"] === "footer") {
                      this.htmlFooter += jsonHtml["html"];
                  }
              }
              return this;
          }

          finish(){
              this.htmlHeader += "</header>";
              this.htmlBody += "</body>";
              this.htmlFooter += "</footer>";
              this.fullHtml += this.htmlHeader+this.htmlBody+this.htmlFooter+"</html>";
              return this;
          }

          getDownloadFile() {
              return super.getDownloadFile(this.fullHtml, 'text/html');
          }

          getContent() {
              return this.fullHtml;
          }
      }

      class JsonObj extends Obj{
          json = {}
          constructor(json) {
              super();
              this.json = json;
          }

          getDownloadFile() {
              return super.getDownloadFile(JSON.stringify(this.json), 'application/json');
          }

          getContent() {
              return this.json;
          }
      }
      document.getElementById("saveBtn").onclick = function() {downloadBuilder()};
      document.getElementById("exportBtn").onclick = function() {exportBuilder()};
  </script>

</body>
</html>
